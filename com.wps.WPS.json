{
    "app-id": "com.wps.WPS",
    "branch": "stable",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "18.08",
    "sdk": "org.freedesktop.Sdk",
    "tags": ["proprietary"],  
    "separate-locales": false,
    "build-options": {
        "no-debuginfo": true
    },
    "finish-args": [
        "--share=ipc", "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--device=dri",
        "--filesystem=host"
    ],
    "command": "wps",
    "modules": [
        {
            "name": "libpng12",
            "config-opts": ["--disable-static"],
            "cleanup": ["/bin", "/include", "/share", "/lib/libpng.*", "/lib/*.la", "/lib/pkgconfig"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp-osl.osuosl.org/pub/libpng/src/libpng12/libpng-1.2.59.tar.xz",
                    "sha256": "b4635f15b8adccc8ad0934eea485ef59cc4cae24d0f0300a9a941e51974ffcc7"
                }
            ]
        },
        {
            "name": "wps",
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm755 apply_extra /app/bin/apply_extra",
                "install -Dm755 wpsrename /app/bin/wpsrename",
                "ln -s ../extra/wps-office/wps /app/bin/wps",
                "ln -s ../extra/wps-office/et /app/bin/et",
                "ln -s ../extra/wps-office/wpp /app/bin/wpp",
                "mkdir -p /app/share/metainfo/",
                "cp com.wps.WPS*.appdata.xml /app/share/metainfo/"
            ],
            "sources": [
                {
                    "type": "script",
                    "dest-filename": "wpsrename",
                    "commands": [
                        "mv $1 $(dirname $1)/$(basename $1|sed -e 's/wps-office-/com.wps.WPS-/')"
                    ]
                },
                {
                    "type": "script",
                    "dest-filename": "apply_extra",
                    "commands": [
                        "tar -xf wps.tar.xz",
                        "rm -f wps.tar.xz",
                        "mv wps-office* wps-office",
                        "sed -i 's:/opt/kingsoft/:/app/extra/:' wps-office/{wps,et,wpp}",
                        "mkdir -p export/share/",
                        "mv wps-office/resource/* export/share",
                        "sed -i -e 's:/usr/:/app/:; s/wps-office-/com.wps.WPS-/;' export/share/applications/wps-office-{wps,et,wpp}.desktop export/share/mime/packages/wps-office-{wps,et,wpp}.xml",
                        /* no rename command */
                        "find export/share/ -name 'wps-office-*' -exec wpsrename '{}' \\;",
                        /* may we integrate there later? */
                        "rm -fr export/share/templates export/share/desktop-directories export/share/applications/appurl*"
                    ]
                },
                {
                    "type": "file",
                    "path": "com.wps.WPS.appdata.xml"
                },
                {
                    "type": "extra-data",
                    "filename": "wps.tar.xz",
                    "only-arches": ["x86_64"],
                    "url": "http://kdl.cc.ksosoft.com/wps-community/download/6757/wps-office_10.1.0.6757_x86_64.tar.xz",
                    "sha256": "0280d3e5a3b0c524f54076db6a904a6fee68b19075f6b879b5d2473622d4627e",
                    "size": 131336404
                },
                {
                    "type": "extra-data",
                    "filename": "wps.tar.xz",
                    "only-arches": ["i386"],
                    "url": "http://kdl.cc.ksosoft.com/wps-community/download/6757/wps-office_10.1.0.6757_x86.tar.xz",
                    "sha256": "d291a63ae39e6ac5d4569db3ab58e9888ddab116f000c406f174bc7fccb86985",
                    "size": 134095644
                }
            ]
        }
    ]
}
