{
    "app-id": "com.wps.WPS",
    "branch": "stable",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "1.6",
    "sdk": "org.freedesktop.Sdk",
    "tags": ["proprietary"],  
    "separate-locales": false,
    "finish-args": [
        "--share=ipc", "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--device=dri",
        "--filesystem=host",
        "--env=WPS_NO_GLOBAL_MENUBAR=1"
    ],
    "command": "wps",
    "modules": [
        {
            "name": "libpng12",
            "config-opts": ["--disable-static"],
            "cleanup": ["/bin", "/include", "/share", "/lib/libpng.*", "/lib/*.la", "/lib/pkgconfig"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp-osl.osuosl.org/pub/libpng/src/libpng12/libpng-1.2.59.tar.xz",
                    "sha256": "b4635f15b8adccc8ad0934eea485ef59cc4cae24d0f0300a9a941e51974ffcc7"
                }
            ]
        },
        {
            "name": "wps",
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm755 apply_extra /app/bin/apply_extra",
                "install -Dm755 wpsrename /app/bin/wpsrename",
                "ln -s ../extra/wps-office/wps /app/bin/wps",
                "ln -s ../extra/wps-office/et /app/bin/et",
                "ln -s ../extra/wps-office/wpp /app/bin/wpp",
                "mkdir -p /app/share/fonts",
                "mkdir -p /app/etc/fonts/",
                "ln -s ../../extra/wps-office/fontconfig/40-wps-office.conf /app/etc/fonts/local.conf",
                "ln -s ../../extra/wps-office/fonts /app/share/fonts/wps-office",
                "mkdir -p /app/share/metainfo/",
                "cp com.wps.WPS*.appdata.xml /app/share/metainfo/"
            ],
            "sources": [
                {
                    "type": "script",
                    "dest-filename": "wpsrename",
                    "commands": [
                        "mv $1 $(dirname $1)/$(basename $1|sed -e 's/wps-office-/com.wps.WPS-/')"
                    ]
                },
                {
                    "type": "script",
                    "dest-filename": "apply_extra",
                    "commands": [
                        "tar -xf wps.tar.xz",
                        "rm -f wps.tar.xz",
                        "mv wps-office* wps-office",
                        "sed -i 's:/opt/kingsoft/:/app/extra/:' wps-office/{wps,et,wpp}",
                        "mkdir -p export/share/",
                        "mv wps-office/resource/* export/share",
                        "sed -i -e 's:/usr/:/app/:; s/wps-office-/com.wps.WPS-/;' export/share/applications/wps-office-{wps,et,wpp}.desktop export/share/mime/packages/wps-office-{wps,et,wpp}.xml",
                        
                        /* no rename command */
                        "find export/share/ -name 'wps-office-*' -exec wpsrename '{}' \\;"
                    ]
                },
                {
                    "type": "file",
                    "path": "com.wps.WPS.appdata.xml"
                },
                {
                    "type": "extra-data",
                    "filename": "wps.tar.xz",
                    "only-arches": ["x86_64"],
                    "url": "http://kdl.cc.ksosoft.com/wps-community/download/a21/wps-office_10.1.0.5707~a21_x86_64.tar.xz",
                    "sha256": "aa875a06e7eef79a30d6e5a4bd03f08eeb1524013edd59122d95a20b1638d9c5",
                    "size": 167646372
                },
                {
                    "type": "extra-data",
                    "filename": "wps.tar.gz",
                    "only-arches": ["i386"],
                    "url": "http://kdl.cc.ksosoft.com/wps-community/download/a21/wps-office_10.1.0.5672~a21_x86.tar.xz",
                    "sha256": "27d50098eac5de3c5b9774ba9046f66aaae20430d35264b7848de372150064b6",
                    "size": 161734960
                }
            ]
        }
    ]
}
